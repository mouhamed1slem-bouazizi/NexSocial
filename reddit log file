Creating new post for user: bef1bbcf-0cf9-4c6b-b486-2e6ce38d5693
📊 Post data: {
  "content": "test agin the video upload after the fix uploading",
  "platforms": [
    "reddit"
  ],
  "selectedAccounts": [
    "dee9da15-8ce4-4e20-b0c9-37126dfad9fc"
  ],
  "media": [
    {
      "name": "Mastaziano__-Aventure _(3).mp4",
      "type": "video",
      "data": "data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAHgobW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAASCsAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAWiV0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAASAIAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAB4AAAAQ4AAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAEgCAAACAAABAAAAAFmdbWRpYQAAACBtZGhkAAAAAAAA
    }
  ],
  "discordChannels": {
    "65b24020-8927-4cfb-9d89-9d2d23e1ff32": "1392079021927305331"
  }
}
Fetching social accounts for user: bef1bbcf-0cf9-4c6b-b486-2e6ce38d5693
Found 6 social accounts for user: bef1bbcf-0cf9-4c6b-b486-2e6ce38d5693
📤 Publishing to 1 accounts: [ 'reddit:suareztn' ]
📎 Processed 1 media files
🚀 Posting to reddit:suareztn...
🔴 Posting to Reddit for account suareztn (attempt 1)
📝 Content: test agin the video upload after the fix uploading
📎 Media items: 1
🔍 Parsed metadata: {}
📊 User moderates 0 subreddits
📊 User karma: 0 (link: 0, comment: 0)
🎯 Posting to user profile: r/u_suareztn
📤 Processing 1 media items for Reddit
🔍 Checking media: Mastaziano__-Aventure _(3).mp4
   type: "video"
   mimeType: ""
   dataMimeType: ""
   data preview: "NO_DATA"
   data starts with 'data:': undefined
   isImage: false, isVideo: true
📷 Creating video post for Reddit
🎬 Attempting Reddit native video upload for v.redd.it hosting...
🔴 Uploading video to Reddit's native hosting: Mastaziano__-Aventure _(3).mp4
📊 Media item structure: {
  hasData: false,
  hasBuffer: true,
  dataType: 'undefined',
  dataPreview: 'NO_DATA',
  bufferLength: 2134072
}
✅ Using existing buffer: 2134072 bytes, MIME: video
📡 Requesting Reddit upload URL with MIME type: video/mp4...
✅ Got Reddit upload data: {
  args: {
    action: '//reddit-uploaded-video.s3-accelerate.amazonaws.com',
    fields: [
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object], [Object],
      [Object]
    ]
  },
  asset: {
    asset_id: 'ru4zymrvt6cf1',
    processing_state: 'incomplete',
    payload: { filepath: 'Mastaziano__-Aventure _(3).mp4' },
    websocket_url: 'wss://k8s-lb.wss.redditmedia.com/ru4zymrvt6cf1?m=AQAA965waIE1BiHCWIJ_RX0KKLWDeXs3ByIIGDfa9_U6IlrI__P1'
  }
}
❌ Reddit native video upload failed: TypeError: source.on is not a function
    at DelayedStream.create (/opt/render/project/src/server/node_modules/delayed-stream/lib/delayed_stream.js:33:10)
    at CombinedStream.append (/opt/render/project/src/server/node_modules/combined-stream/lib/combined_stream.js:45:37)
    at FormData.append (/opt/render/project/src/server/node_modules/form-data/lib/form_data.js:77:3)
    at /opt/render/project/src/server/routes/postRoutes.js:2087:24
    at Array.forEach (<anonymous>)
⚠️ Reddit native video upload failed, falling back to Imgur: source.on is not a function
    at uploadVideoToRedditNative (/opt/render/project/src/server/routes/postRoutes.js:2086:46)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async attemptRedditPost (/opt/render/project/src/server/routes/postRoutes.js:2260:41)
    at async postToReddit (/opt/render/project/src/server/routes/postRoutes.js:2652:12)
    at async /opt/render/project/src/server/routes/postRoutes.js:118:22
📤 Uploading video to Imgur: Mastaziano__-Aventure _(3).mp4
📊 Base64 video length: 2845432 characters
❌ Imgur video upload failed: 500 - {"status":500,"success":false,"data":{"error":"An unexpected error has occurred","request":"/3/upload","method":"POST"}}
❌ All video upload methods failed, falling back to text post: ReferenceError: mediaType is not defined
    at uploadMediaToImgur (/opt/render/project/src/server/routes/postRoutes.js:1727:32)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async attemptRedditPost (/opt/render/project/src/server/routes/postRoutes.js:2282:35)
    at async postToReddit (/opt/render/project/src/server/routes/postRoutes.js:2652:12)
    at async /opt/render/project/src/server/routes/postRoutes.js:118:22
    at async Promise.all (index 0)
    at async /opt/render/project/src/server/routes/postRoutes.js:151:5
📤 Submitting self post to Reddit with data: {
  api_type: 'json',
  kind: 'self',
  sr: 'u_suareztn',
  title: 'test agin the video upload after the fix uploading',
  text: 'test agin the video upload after the fix uploading\n' +
    '\n' +
    '**📎 Media Attachment: Mastaziano__-Aventure _(3).mp4**\n' +
    '- Type: Unknown\n' +
    '\n' +
    '*(video upload failed: mediaType is not defined)*',
  sendreplies: true,
  validate_on_submit: true
}
🔑 Using access token: eyJhbGciOi...
📊 Reddit submit response status: 200
📊 Reddit submit response headers: {
  'accept-ranges': 'bytes',
  'cache-control': 'private, s-maxage=0, max-age=0, must-revalidate, no-store',
  connection: 'keep-alive',
  'content-encoding': 'gzip',
  'content-type': 'application/json; charset=UTF-8',
  date: 'Fri, 11 Jul 2025 06:18:08 GMT',
  expires: '-1',
  nel: '{"report_to": "w3-reporting-nel", "max_age": 14400, "include_subdomains": false, "success_fraction": 1.0, "failure_fraction": 1.0}',
  'report-to': '{"group": "w3-reporting-nel", "max_age": 14400, "include_subdomains": true,  "endpoints": [{ "url": "https://w3-reporting-nel.reddit.com/reports" }]}, {"group": "w3-reporting", "max_age": 14400, "include_subdomains": true, "endpoints": [{ "url": "https://w3-reporting.reddit.com/reports" }]}, {"group": "w3-reporting-csp", "max_age": 14400, "include_subdomains": true, "endpoints": [{ "url": "https://w3-reporting-csp.reddit.com/reports" }]}',
  server: 'snooserv',
  'set-cookie': 'edgebucket=kVHqCs0F5QjNuD6f6n; Domain=reddit.com; Max-Age=63071999; Path=/;  secure',
  'strict-transport-security': 'max-age=31536000; includeSubdomains',
  'transfer-encoding': 'chunked',
  vary: 'Accept-Encoding',
  via: '1.1 varnish',
  'x-content-type-options': 'nosniff',
  'x-frame-options': 'SAMEORIGIN',
  'x-ratelimit-remaining': '998.0',
  'x-ratelimit-reset': '111',
  'x-ratelimit-used': '2',
  'x-ua-compatible': 'IE=edge',
  'x-xss-protection': '1; mode=block'
}
📊 Reddit submit response body (first 500 chars): {"json": {"errors": [], "data": {"url": "https://www.reddit.com/r/u_suareztn/comments/1lwzktd/test_agin_the_video_upload_after_the_fix_uploading/", "drafts_count": 0, "id": "1lwzktd", "name": "t3_1lwzktd"}}}
📊 Reddit submit parsed data: {
  "json": {
    "errors": [],
    "data": {
      "url": "https://www.reddit.com/r/u_suareztn/comments/1lwzktd/test_agin_the_video_upload_after_the_fix_uploading/",
      "drafts_count": 0,
      "id": "1lwzktd",
      "name": "t3_1lwzktd"
    }
  }
}
✅ Posted to Reddit successfully
📊 Post details: ID=1lwzktd, URL=https://reddit.comhttps://www.reddit.com/r/u_suareztn/comments/1lwzktd/test_agin_the_video_upload_after_the_fix_uploading/